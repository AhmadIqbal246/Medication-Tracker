{% extends 'medications/base.html' %}

{% block title %}{{ title }} - Medication Reminder{% endblock %}

{% block header %}💊 {{ title }}{% endblock %}

{% block content %}
<div class="main-content">
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="{{ form.name.id_for_label }}">💊 Medication Name</label>
            {{ form.name }}
            {{ form.name.errors }}
        </div>
        
        <div class="form-group">
            <label for="{{ form.dosage.id_for_label }}">📋 Dosage Information</label>
            {{ form.dosage }}
            {{ form.dosage.errors }}
        </div>
        
        <div class="form-group">
            <label for="{{ form.scheduled_datetime.id_for_label }}">📅 Scheduled Date & Time</label>
            {{ form.scheduled_datetime }}
            {{ form.scheduled_datetime.errors }}
            <small>{{ form.scheduled_datetime.help_text }}</small>
        </div>
        
        {% if form.non_field_errors %}
            <div class="alert alert-error">
                {{ form.non_field_errors }}
            </div>
        {% endif %}
        
        <div style="margin-top: 30px;">
            <button type="submit" class="btn btn-primary">💾 Save Medication</button>
            <a href="{% url 'medications:medication_list' %}" class="btn btn-secondary">❌ Cancel</a>
        </div>
    </form>
</div>

<script>
    // Set minimum datetime to current time with proper timezone handling
    document.addEventListener('DOMContentLoaded', function() {
        const datetimeInput = document.querySelector('input[type="datetime-local"]');
        if (datetimeInput) {
            // Get current time in local timezone
            const now = new Date();
            
            // Format for datetime-local input (YYYY-MM-DDTHH:MM)
            const formatDateTime = (date) => {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day}T${hours}:${minutes}`;
            };
            
            // Set minimum time to current time
            datetimeInput.min = formatDateTime(now);
            
            // If no value is set, set it to current time
            if (!datetimeInput.value) {
                datetimeInput.value = formatDateTime(now);
            }
            
            // Display current time for debugging
            console.log('Current local time:', formatDateTime(now));
            console.log('Input value:', datetimeInput.value);
        }
    });
</script>
{% endblock %}
