{% extends 'medications/base.html' %}

{% block title %}My Medications - Medication Reminder{% endblock %}

{% block header %}My Medications{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{% url 'medications:add_medication' %}" class="btn btn-primary">Add New Medication</a>
</div>

<!-- Statistics Dashboard -->
<div class="mb-3" style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
    <h3 style="margin-bottom: 15px; color: #495057;">üìä Dashboard Statistics</h3>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        <div class="stat-item" style="flex: 1; min-width: 120px; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #007bff;">{{ total_medications }}</div>
            <div style="color: #6c757d;">Total</div>
        </div>
        <div class="stat-item" style="flex: 1; min-width: 120px; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #ffc107;">{{ pending_count }}</div>
            <div style="color: #6c757d;">Pending</div>
        </div>
        <div class="stat-item" style="flex: 1; min-width: 120px; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #28a745;">{{ taken_count }}</div>
            <div style="color: #6c757d;">Taken</div>
        </div>
        <div class="stat-item" style="flex: 1; min-width: 120px; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #17a2b8;">{{ today_count }}</div>
            <div style="color: #6c757d;">Today</div>
        </div>
        {% if overdue_count > 0 %}
        <div class="stat-item" style="flex: 1; min-width: 120px; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #dc3545;">{{ overdue_count }}</div>
            <div style="color: #6c757d;">‚ö†Ô∏è Overdue</div>
        </div>
        {% endif %}
    </div>
    <div style="text-align: center; margin-top: 10px; color: #6c757d; font-size: 14px;">
        Last updated: {{ current_time|date:"M d, Y \a\t H:i" }}
    </div>
</div>

<!-- Pending Medications -->
<h2>Pending Medications</h2>
{% if pending_medications %}
    {% for medication in pending_medications %}
        <div class="medication-card {% if medication.is_overdue %}overdue{% endif %}">
            <h4>{{ medication.name }}</h4>
            <p><strong>Dosage:</strong> {{ medication.dosage }}</p>
            <p><strong>Scheduled:</strong> {{ medication.scheduled_datetime|date:"M d, Y \a\t H:i" }}
                {% if medication.is_overdue %}
                    <span style="color: #dc3545; font-weight: bold;">(OVERDUE)</span>
                {% endif %}
            </p>
            <p><strong>Status:</strong> <span style="color: #ffc107;">{{ medication.get_status_display }}</span></p>
            
            <div class="medication-actions">
                <!-- Mark as Taken Form -->
                <form method="post" action="{% url 'medications:mark_as_taken' medication.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm" onclick="return confirm('Mark {{ medication.name }} as taken?')">Mark as Taken</button>
                </form>
                
                <a href="{% url 'medications:edit_medication' medication.id %}" class="btn btn-primary btn-sm">Edit</a>
                
                <!-- Delete Form -->
                <form method="post" action="{% url 'medications:delete_medication' medication.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete {{ medication.name }}?')">Delete</button>
                </form>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div class="no-medications">
        <p>No pending medications. <a href="{% url 'medications:add_medication' %}">Add your first medication</a>!</p>
    </div>
{% endif %}

<!-- Taken Medications -->
<h2>Recently Taken Medications</h2>
{% if taken_medications %}
    {% for medication in taken_medications %}
        <div class="medication-card taken">
            <h4>{{ medication.name }}</h4>
            <p><strong>Dosage:</strong> {{ medication.dosage }}</p>
            <p><strong>Was Scheduled:</strong> {{ medication.scheduled_datetime|date:"M d, Y \a\t H:i" }}</p>
            <p><strong>Status:</strong> <span style="color: #28a745;">{{ medication.get_status_display }}</span> ‚úì</p>
            <p><strong>Updated:</strong> {{ medication.updated_at|date:"M d, Y \a\t H:i" }}</p>
            
            <div class="medication-actions">
                <a href="{% url 'medications:edit_medication' medication.id %}" class="btn btn-primary btn-sm">Edit</a>
                
                <!-- Delete Form -->
                <form method="post" action="{% url 'medications:delete_medication' medication.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete {{ medication.name }}?')">Delete</button>
                </form>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div class="no-medications">
        <p>No medications marked as taken yet.</p>
    </div>
{% endif %}
{% endblock %}
